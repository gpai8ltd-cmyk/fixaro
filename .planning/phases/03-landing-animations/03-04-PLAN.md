---
phase: 03-landing-animations
plan: 04
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - tools-shop/src/components/CountdownTimer.tsx
  - tools-shop/src/app/(shop)/page.tsx
  - tools-shop/src/components/ProductCard.tsx
  - tools-shop/src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Sale banner displays countdown timer showing days, hours, minutes, seconds"
    - "Countdown timer updates every second"
    - "Product cards show sale percentage badge when product has discount"
    - "Product cards have enhanced hover effects (lift, scale, border glow)"
  artifacts:
    - path: "tools-shop/src/components/CountdownTimer.tsx"
      provides: "Countdown timer component with cleanup"
      exports: ["default"]
    - path: "tools-shop/src/components/ProductCard.tsx"
      provides: "Enhanced product card with hover effects"
      contains: "card-hover-enhanced"
  key_links:
    - from: "CountdownTimer.tsx"
      to: "setInterval cleanup"
      via: "useEffect return function"
      pattern: "clearInterval"
    - from: "page.tsx sale banner"
      to: "CountdownTimer.tsx"
      via: "component import"
      pattern: "CountdownTimer"
---

<objective>
Enhance sale banner with countdown timer and improve product card animations.

Purpose: LAND-06 (countdown timer) creates urgency for sales. ANIM-02/ANIM-03 (card enhancements) improve visual feedback across the site. These are the final polish elements.

Output: Sale banner with live countdown, enhanced product cards with better hover effects.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-landing-animations/03-01-SUMMARY.md
@.planning/phases/03-landing-animations/03-RESEARCH.md

# Files to reference/modify
@tools-shop/src/app/(shop)/page.tsx
@tools-shop/src/components/ProductCard.tsx
@tools-shop/src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CountdownTimer component</name>
  <files>tools-shop/src/components/CountdownTimer.tsx</files>
  <action>
Create a countdown timer component with proper cleanup:

```typescript
// tools-shop/src/components/CountdownTimer.tsx
'use client';

import { useEffect, useState } from 'react';

interface TimeLeft {
  days: number;
  hours: number;
  minutes: number;
  seconds: number;
}

interface CountdownTimerProps {
  targetDate: Date;
}

const timeLabels: Record<keyof TimeLeft, string> = {
  days: 'дни',
  hours: 'часа',
  minutes: 'мин',
  seconds: 'сек',
};

export default function CountdownTimer({ targetDate }: CountdownTimerProps) {
  const [timeLeft, setTimeLeft] = useState<TimeLeft>({
    days: 0,
    hours: 0,
    minutes: 0,
    seconds: 0,
  });

  useEffect(() => {
    function calculateTimeLeft(): TimeLeft {
      const difference = +targetDate - +new Date();

      if (difference > 0) {
        return {
          days: Math.floor(difference / (1000 * 60 * 60 * 24)),
          hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
          minutes: Math.floor((difference / 1000 / 60) % 60),
          seconds: Math.floor((difference / 1000) % 60),
        };
      }

      return { days: 0, hours: 0, minutes: 0, seconds: 0 };
    }

    // Initial calculation
    setTimeLeft(calculateTimeLeft());

    // Update every second
    const timer = setInterval(() => {
      setTimeLeft(calculateTimeLeft());
    }, 1000);

    // CRITICAL: Cleanup on unmount to prevent memory leaks
    return () => clearInterval(timer);
  }, [targetDate]);

  return (
    <div className="flex gap-3 md:gap-4 justify-center">
      {(Object.entries(timeLeft) as [keyof TimeLeft, number][]).map(([unit, value]) => (
        <div key={unit} className="text-center">
          <div className="bg-white/20 backdrop-blur-sm rounded-lg px-3 py-2 min-w-[50px] md:min-w-[60px]">
            <span className="text-xl md:text-2xl font-bold text-white tabular-nums">
              {String(value).padStart(2, '0')}
            </span>
          </div>
          <p className="text-xs text-white/70 mt-1">{timeLabels[unit]}</p>
        </div>
      ))}
    </div>
  );
}
```

Key points:
- Proper useEffect cleanup with clearInterval (per research - prevents memory leaks)
- tabular-nums for fixed-width digits (prevents layout shift)
- Bulgarian labels: дни, часа, мин, сек
- targetDate passed as prop for flexibility
- Zero-padded values with padStart
- Semi-transparent background (bg-white/20) to blend with sale banner gradient
  </action>
  <verify>
1. File exists: `ls tools-shop/src/components/CountdownTimer.tsx`
2. Has cleanup: `grep "clearInterval" tools-shop/src/components/CountdownTimer.tsx`
3. Has Bulgarian labels: `grep "дни" tools-shop/src/components/CountdownTimer.tsx`
4. TypeScript valid: `cd tools-shop && npx tsc --noEmit`
  </verify>
  <done>
- CountdownTimer.tsx created with setInterval
- clearInterval cleanup in useEffect return
- Bulgarian time labels
- tabular-nums for consistent digit width
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance sale banner with countdown timer</name>
  <files>tools-shop/src/app/(shop)/page.tsx</files>
  <action>
Update the sale banner section to include the countdown timer:

1. Add import at top of file:
```typescript
import CountdownTimer from '@/components/CountdownTimer';
```

2. Find the Sale Banner section (around line 318-350, after Testimonials and Brand Partners):
```tsx
{/* Sale Banner */}
<section className="py-12 md:py-16" aria-label="Промоция">
  <div className="container-custom">
    <div className="relative bg-gradient-primary rounded-2xl overflow-hidden">
```

3. Replace the entire Sale Banner content. The new structure should be:
```tsx
{/* Sale Banner */}
<section className="py-12 md:py-16" aria-label="Промоция">
  <div className="container-custom">
    <div className="relative bg-gradient-primary rounded-2xl overflow-hidden">
      {/* Background pattern */}
      <div className="absolute inset-0 opacity-10">
        <div className="absolute inset-0" style={{
          backgroundImage: `url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 20.5V18H0v-2h20v-2.5L25 18l-5 2.5zm20-2.5V16H32v2h8v-2.5zm0 2.5V22H32v-2h8v2.5zM0 22v-2h8v2H0z' fill='%23ffffff' fill-opacity='1' fill-rule='evenodd'/%3E%3C/svg%3E")`,
        }} />
      </div>

      <div className="relative p-8 md:p-12 lg:p-16">
        <div className="text-center md:text-left md:flex md:items-center md:justify-between md:gap-8">
          <div className="mb-6 md:mb-0">
            <span className="inline-block px-3 py-1 bg-white/20 text-white rounded-full text-sm font-medium mb-3">
              Ограничено предложение
            </span>
            <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-white">
              До -40% на избрани инструменти
            </h2>
            <p className="text-white/80 mt-2 max-w-md">
              Не пропускайте нашите специални оферти!
            </p>
          </div>

          <div className="flex flex-col items-center gap-4">
            <p className="text-white/70 text-sm">Промоцията приключва след:</p>
            <CountdownTimer targetDate={new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)} />
            <Link
              href="/products?sale=true"
              className="btn btn-lg bg-white text-[var(--primary)] hover:bg-slate-100 mt-2"
            >
              Виж намаленията
              <ArrowRight size={20} aria-hidden="true" />
            </Link>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
```

Key points:
- targetDate set to 7 days from now (placeholder per research)
- Added "Промоцията приключва след:" label above timer
- Centered layout on mobile, side-by-side on desktop
- Button moved below countdown for better visual hierarchy
- Kept existing background pattern
  </action>
  <verify>
1. Import present: `grep "import CountdownTimer" tools-shop/src/app/\\(shop\\)/page.tsx`
2. Component used: `grep "<CountdownTimer" tools-shop/src/app/\\(shop\\)/page.tsx`
3. Build succeeds: `cd tools-shop && npm run build`
4. Dev server shows countdown: Run dev server, check sale banner has ticking timer
  </verify>
  <done>
- CountdownTimer imported in page.tsx
- Sale banner displays countdown with 7-day target
- Timer ticks down every second
- Layout works on mobile and desktop
  </done>
</task>

<task type="auto">
  <name>Task 3: Enhance ProductCard hover effects</name>
  <files>
    tools-shop/src/components/ProductCard.tsx
    tools-shop/src/app/globals.css
  </files>
  <action>
Enhance the ProductCard component with improved hover effects:

1. Update globals.css - add enhanced product card styles (append after .product-card:hover around line 385):

```css
/* Enhanced product card hover with scale and glow */
.product-card {
  will-change: transform, box-shadow;
}

.product-card:hover {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
              0 0 0 2px var(--primary);
  border-color: var(--primary);
  transform: translateY(-8px) scale(1.02);
}

/* Quick view overlay enhancement */
.product-card .quick-view-overlay {
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.product-card:hover .quick-view-overlay {
  opacity: 1;
  transform: translateY(0);
}

/* Sale badge pulse animation */
.sale-badge-pulse {
  animation: pulse-badge 2s ease-in-out infinite;
}

@keyframes pulse-badge {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}
```

2. Update ProductCard.tsx - enhance the hover overlay and sale badge:

Find the existing hover actions div (around line 117-133):
```tsx
{/* Hover actions */}
{isAvailable && (
  <div className="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100">
```

Replace with enhanced version using the new quick-view-overlay class:
```tsx
{/* Hover actions - Quick view overlay */}
{isAvailable && (
  <div className="quick-view-overlay absolute inset-0 bg-black/30 flex items-center justify-center gap-3">
    <button
      onClick={handleAddToCart}
      className="w-12 h-12 bg-white rounded-full flex items-center justify-center text-[var(--foreground)] hover:bg-[var(--primary)] hover:text-white transition-colors shadow-lg transform hover:scale-110"
      aria-label={`Добави ${name} в количката`}
    >
      <ShoppingCart size={20} aria-hidden="true" />
    </button>
    <span
      className="w-12 h-12 bg-white rounded-full flex items-center justify-center text-[var(--foreground)] hover:bg-[var(--primary)] hover:text-white transition-colors shadow-lg transform hover:scale-110"
      aria-label="Преглед"
    >
      <Eye size={20} aria-hidden="true" />
    </span>
  </div>
)}
```

Also enhance the sale badge (around line 79):
Find:
```tsx
{discount > 0 && (
  <span className="sale-badge">-{discount}%</span>
)}
```

Replace with:
```tsx
{discount > 0 && (
  <span className="sale-badge sale-badge-pulse">-{discount}%</span>
)}
```

Key points:
- Enhanced transform: translateY(-8px) scale(1.02) for more pronounced lift
- Added 2px primary border glow on hover
- Quick view overlay now slides in from below with transform
- Action buttons have hover:scale-110 for micro-interaction
- Sale badge has subtle pulse animation to draw attention
- will-change on product card for performance hint
  </action>
  <verify>
1. CSS has enhanced styles: `grep "scale(1.02)" tools-shop/src/app/globals.css`
2. CSS has pulse badge: `grep "pulse-badge" tools-shop/src/app/globals.css`
3. ProductCard has quick-view-overlay: `grep "quick-view-overlay" tools-shop/src/components/ProductCard.tsx`
4. ProductCard has sale-badge-pulse: `grep "sale-badge-pulse" tools-shop/src/components/ProductCard.tsx`
5. Build succeeds: `cd tools-shop && npm run build`
6. Hover on product cards in dev server - enhanced lift effect visible
  </verify>
  <done>
- globals.css has enhanced .product-card:hover styles
- ProductCard.tsx uses quick-view-overlay class
- Sale badge has pulse animation
- Action buttons have scale effect on hover
- ANIM-02 (card hover) and ANIM-03 (product card enhancements) complete
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` - passes without errors
2. Homepage sale banner shows countdown timer (days, hours, minutes, seconds)
3. Timer updates every second (watch numbers decrement)
4. Navigate away and back - no console warnings about memory leaks or unmounted components
5. Hover on product cards - see enhanced lift (8px) + slight scale (1.02) + border glow
6. Sale badge on discounted products has subtle pulse animation
7. Quick view overlay slides in smoothly from below on product hover
</verification>

<success_criteria>
1. LAND-06: Sale banner has working countdown timer with Bulgarian labels
2. Timer updates every second and has proper cleanup
3. ANIM-02: Cards have enhanced hover effects (lift, scale, border glow)
4. ANIM-03: Product cards have quick view overlay animation and sale badge pulse
5. No console errors or memory leak warnings
</success_criteria>

<output>
After completion, create `.planning/phases/03-landing-animations/03-04-SUMMARY.md`
</output>
